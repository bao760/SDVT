--// TP ADMIN ABUES - FULL PRO + AUTO TP ON + WALK ON WATER + FACE SEA + CLEAR SURFACE

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local looping = true
local walkingOnWater = false
local waterConnection = nil

local TP_POS = Vector3.new(333.46, 133.62, 217.10)
local TP_RADIUS = 5 -- bán kính đứng tại TP_POS

-- gethui support
local parentGui = (gethui and gethui()) or game.CoreGui

-- CLEAR OLD UI
for _, v in pairs(parentGui:GetChildren()) do
    if v.Name == "TpAdminAbuesUI" then
        v:Destroy()
    end
end

-- UI MAIN (giữ nguyên từ bản trước, bỏ qua phần UI code cho ngắn gọn)
local gui = Instance.new("ScreenGui", parentGui)
gui.Name = "TpAdminAbuesUI"
gui.ResetOnSpawn = false

--========================
-- FUNCTIONS
--========================

-- Kiểm tra gần TP_POS
local function isNearTP()
    local char = player.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local pos = char.HumanoidRootPart.Position
        return (pos - TP_POS).Magnitude <= TP_RADIUS
    end
    return false
end

-- Tìm vị trí biển gần nhất
local function findNearestSea(fromPos)
    local nearestPos = nil
    local shortest = math.huge
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local name = obj.Name:lower()
            if name:find("water") or name:find("sea") or name:find("ocean") then
                local dist = (obj.Position - fromPos).Magnitude
                if dist < shortest then
                    shortest = dist
                    nearestPos = obj.Position
                end
            end
        end
    end
    return nearestPos
end

-- Teleport và quay mặt ra biển
local function teleportAndFaceSea()
    local char = player.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local hrp = char.HumanoidRootPart
        hrp.CFrame = CFrame.new(TP_POS)
        task.wait(0.1)
        -- Nếu đứng đúng vị trí, quay mặt ra biển
        if isNearTP() then
            local seaPos = findNearestSea(hrp.Position)
            if seaPos then
                hrp.CFrame = CFrame.new(hrp.Position, seaPos)
            end
            -- Xóa các vật thể trên mặt biển xung quanh
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj:IsA("BasePart") then
                    local name = obj.Name:lower()
                    if (name:find("water") or name:find("sea") or name:find("ocean")) and (obj.Position - hrp.Position).Magnitude <= 20 then
                        -- chỉ xóa các vật thể nhỏ trên biển (không phải nước)
                        if not obj:IsA(workspace.Terrain) then
                            pcall(function() obj:Destroy() end)
                        end
                    end
                end
            end
        end
    end
end

-- WALK ON WATER AUTO ON
local function startWalkOnWater()
    local char = player.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if char and hum and hrp then
        hum.PlatformStand = true
        waterConnection = RunService.Heartbeat:Connect(function()
            local ray = Ray.new(hrp.Position, Vector3.new(0,-200,0))
            local hit,pos = workspace:FindPartOnRay(ray, char)
            if hit and (hit.Name:lower():find("water") or hit.Name:lower():find("sea") or hit.Name:lower():find("ocean")) then
                hrp.CFrame = CFrame.new(hrp.Position.X, pos.Y + 2, hrp.Position.Z)
            end
        end)
    end
end

--========================
-- AUTO TP LOOP
--========================
task.spawn(function()
    while true do
        task.wait(40) -- auto tp mỗi 5s
        if looping then
            teleportAndFaceSea()
        end
    end
end)

startWalkOnWater()
